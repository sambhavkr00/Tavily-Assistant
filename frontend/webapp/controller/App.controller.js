sap.ui.define(
  ["sap/ui/core/mvc/Controller", "sap/ui/model/json/JSONModel"],
  function (Controller, JSONModel) {
    "use strict";

    return Controller.extend("tavily.assistant.frontend.controller.App", {
      onInit: function () {
        // Set a default model for the view
        var oModel = new JSONModel({
          prompt: "",
          response:
            "Responses will be generated by a Large Language Model (LLM) and may not always be accurate.",
        });
        this.getView().setModel(oModel);
      },

      onSendPress: function () {
        var oView = this.getView();
        var oModel = oView.getModel();
        var sPrompt = oView.byId("promptInput").getValue();

        if (!sPrompt) {
          return;
        }

        oModel.setProperty("/response", "");
        oView.setBusy(true);

        // Replace with your backend URL
        var sBackendUrl = "/api";

        fetch(sBackendUrl, {
          method: "POST",
          headers: {
            "Content-Type": "application/json",
          },
          body: JSON.stringify({ prompt: sPrompt }),
        })
          .then((response) => response.json())
          .then((data) => {
            oModel.setProperty("/response", data.output || data.error);
          })
          .catch((error) => {
            oModel.setProperty("/response", "Error: " + error.message);
          })
          .finally(function () {
            oView.setBusy(false);
          });
      },
    });
  }
);
